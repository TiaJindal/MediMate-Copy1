<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Profile - MediMate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#8b5cf6',
                        dark: '#1e293b',
                        light: '#f8fafc'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="min-h-screen">
    <script>
        if (!localStorage.getItem('loggedInUser')) {
            window.location.href = 'login.html?redirect=profile.html';
        }
    </script>
    
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-heartbeat text-primary text-2xl mr-2"></i>
                        <span class="text-xl font-bold text-gray-800">MediMate</span>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="index.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Home</a>
                        <a href="chatbot.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Chatbot</a>
                        <a href="medicines.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Medicines</a>
                        <a href="history.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">History</a>
                        <a href="profile.html" class="border-primary text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Profile</a>
                    </div>
                </div>
                <div class="hidden sm:ml-6 sm:flex sm:items-center space-x-4">
                    <button id="bookAppointmentBtn" class="bg-secondary text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition inline-flex items-center">
                        <i class="fas fa-calendar-check mr-2"></i>Book Appointment
                    </button>
                    <button id="cartBtn" class="relative text-gray-700 hover:text-primary focus:outline-none">
                        <i class="fas fa-shopping-cart text-2xl"></i>
                        <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-1.5">0</span>
                    </button>
                    <div id="navbarUser" class="flex items-center space-x-2"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Profile Section -->
    <section class="py-16">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h1 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Your Medical Profile</h1>
                <p class="mt-3 text-xl text-gray-500">
                    Complete your medical profile for personalized AI medical assistance
                </p>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8">
                <form id="medicalProfileForm" class="space-y-8">
                    <!-- Basic Information -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-user-circle text-primary mr-3"></i>
                            Basic Information
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Age</label>
                                <input type="number" id="age" name="age" min="1" max="120" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Gender</label>
                                <select id="gender" name="gender" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                    <option value="prefer-not-to-say">Prefer not to say</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Blood Group</label>
                                <select id="bloodGroup" name="bloodGroup" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select Blood Group</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Weight (kg)</label>
                                <input type="number" id="weight" name="weight" min="20" max="300" step="0.1" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Height (cm)</label>
                                <input type="number" id="height" name="height" min="100" max="250" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Allergies -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                            Allergies
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Drug Allergies</label>
                                <input type="text" id="drugAllergies" name="drugAllergies" placeholder="e.g., Penicillin, Aspirin" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Food Allergies</label>
                                <input type="text" id="foodAllergies" name="foodAllergies" placeholder="e.g., Peanuts, Shellfish" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Environmental Allergies</label>
                                <input type="text" id="envAllergies" name="envAllergies" placeholder="e.g., Pollen, Dust" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Current Medications -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-pills text-blue-500 mr-3"></i>
                            Current Medications
                        </h2>
                        <div id="medicationsList" class="space-y-4">
                            <div class="medication-item flex items-center space-x-4 p-4 border border-gray-200 rounded-lg">
                                <input type="text" name="medications[]" placeholder="Medication name and dosage" class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <button type="button" class="remove-medication text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="addMedicationBtn" class="mt-4 bg-blue-100 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-200 transition">
                            <i class="fas fa-plus mr-2"></i>Add Medication
                        </button>
                    </div>

                    <!-- Medical Conditions -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-heartbeat text-red-500 mr-3"></i>
                            Medical Conditions
                        </h2>
                        <div id="conditionsList" class="space-y-4">
                            <div class="condition-item flex items-center space-x-4 p-4 border border-gray-200 rounded-lg">
                                <input type="text" name="conditions[]" placeholder="Medical condition" class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <button type="button" class="remove-condition text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="addConditionBtn" class="mt-4 bg-blue-100 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-200 transition">
                            <i class="fas fa-plus mr-2"></i>Add Condition
                        </button>
                    </div>

                    <!-- Lifestyle Information -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-running text-green-500 mr-3"></i>
                            Lifestyle Information
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Smoking Status</label>
                                <select id="smoking" name="smoking" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select</option>
                                    <option value="never">Never smoked</option>
                                    <option value="former">Former smoker</option>
                                    <option value="current">Current smoker</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Alcohol Consumption</label>
                                <select id="alcohol" name="alcohol" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select</option>
                                    <option value="never">Never</option>
                                    <option value="occasional">Occasional</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="heavy">Heavy</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Exercise Frequency</label>
                                <select id="exercise" name="exercise" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select</option>
                                    <option value="never">Never</option>
                                    <option value="rarely">Rarely</option>
                                    <option value="sometimes">Sometimes</option>
                                    <option value="regular">Regular</option>
                                    <option value="daily">Daily</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Diet Type</label>
                                <select id="diet" name="diet" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select</option>
                                    <option value="omnivore">Omnivore</option>
                                    <option value="vegetarian">Vegetarian</option>
                                    <option value="vegan">Vegan</option>
                                    <option value="keto">Keto</option>
                                    <option value="paleo">Paleo</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-phone text-red-500 mr-3"></i>
                            Emergency Contact
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Emergency Contact Name</label>
                                <input type="text" id="emergencyName" name="emergencyName" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Emergency Contact Phone</label>
                                <input type="tel" id="emergencyPhone" name="emergencyPhone" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Relationship</label>
                                <input type="text" id="emergencyRelation" name="emergencyRelation" placeholder="e.g., Spouse, Parent, Friend" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="flex justify-center pt-8">
                        <button type="submit" class="bg-primary text-white px-8 py-4 rounded-lg font-semibold hover:bg-blue-700 transition text-lg">
                            <i class="fas fa-save mr-2"></i>Save Medical Profile
                        </button>
                    </div>
                </form>

                <!-- Success Message -->
                <div id="successMessage" class="hidden mt-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg text-center">
                    <i class="fas fa-check-circle mr-2"></i>
                    Medical profile saved successfully! Your AI assistant will now provide more personalized recommendations.
                </div>
            </div>
        </div>
    </section>

    <!-- Book Appointment Modal -->
    <div id="appointmentModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
            <button id="closeModalBtn" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <h2 class="text-2xl font-bold mb-4 text-primary">Book Appointment</h2>
            <form id="appointmentForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700">Doctor</label>
                    <select name="doctor" required class="w-full border rounded px-3 py-2">
                        <option value="">Select Doctor</option>
                        <option value="Dr. Emily Rodriguez">Dr. Emily Rodriguez</option>
                        <option value="Dr. John Smith">Dr. John Smith</option>
                        <option value="Dr. Priya Patel">Dr. Priya Patel</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700">Date</label>
                    <input type="date" name="date" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block text-gray-700">Time</label>
                    <input type="time" name="time" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block text-gray-700">Reason</label>
                    <textarea name="reason" required class="w-full border rounded px-3 py-2" placeholder="Describe your reason..."></textarea>
                </div>
                <button type="submit" class="w-full bg-primary text-white py-2 rounded hover:bg-blue-700 font-semibold">Book Appointment</button>
            </form>
            <div id="appointmentSuccess" class="hidden mt-4 text-green-600 font-semibold text-center">Appointment booked successfully!</div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
            <button id="closeCartBtn" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <h2 class="text-2xl font-bold mb-4 text-primary">Your Cart</h2>
            <div id="cartItems"></div>
            <div class="mt-4 flex justify-between items-center">
                <span class="font-bold text-lg">Total: <span id="cartTotal">₹0</span></span>
                <button id="buyBtn" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-700 font-semibold">Buy</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-sm p-6 relative">
            <button id="closePaymentBtn" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <h2 class="text-2xl font-bold mb-4 text-primary">Payment</h2>
            <form id="paymentForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700">Choose Payment Method</label>
                    <select required class="w-full border rounded px-3 py-2">
                        <option value="">Select</option>
                        <option value="upi">UPI</option>
                        <option value="card">Credit/Debit Card</option>
                        <option value="netbanking">Netbanking</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-primary text-white py-2 rounded hover:bg-blue-700 font-semibold">Pay</button>
            </form>
            <div id="paymentSuccess" class="hidden mt-4 text-green-600 font-semibold text-center">Payment Successful! Thank you for your purchase.</div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white mt-16">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center">
                        <i class="fas fa-heartbeat text-primary text-2xl mr-2"></i>
                        <span class="text-xl font-bold">MediMate</span>
                    </div>
                    <p class="mt-4 text-gray-400">
                        Your trusted AI-powered medical assistant for instant health insights and support.
                    </p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold">Services</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="chatbot.html" class="text-gray-400 hover:text-white">Medical Chatbot</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Symptom Checker</a></li>
                        <li><a href="medicines.html" class="text-gray-400 hover:text-white">E-Pharmacy</a></li>
                        <li><a href="history.html" class="text-gray-400 hover:text-white">Health Records</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold">Company</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">About Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Careers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold">Contact</h3>
                    <ul class="mt-4 space-y-2">
                        <li class="flex items-center">
                            <i class="fas fa-envelope mr-2 text-gray-400"></i>
                            <span class="text-gray-400">support@medimate.com</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone mr-2 text-gray-400"></i>
                            <span class="text-gray-400">+1 (555) 123-4567</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-map-marker-alt mr-2 text-gray-400"></i>
                            <span class="text-gray-400">San Francisco, CA</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-12 pt-8 border-t border-gray-700 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400">© 2023 MediMate. All rights reserved.</p>
                <div class="flex space-x-6 mt-4 md:mt-0">
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Load existing profile data
        document.addEventListener('DOMContentLoaded', function() {
            const profile = JSON.parse(localStorage.getItem('userMedicalProfile') || '{}');
            
            // Populate form fields
            if (profile.age) document.getElementById('age').value = profile.age;
            if (profile.gender) document.getElementById('gender').value = profile.gender;
            if (profile.bloodGroup) document.getElementById('bloodGroup').value = profile.bloodGroup;
            if (profile.weight) document.getElementById('weight').value = profile.weight;
            if (profile.height) document.getElementById('height').value = profile.height;
            if (profile.drugAllergies) document.getElementById('drugAllergies').value = profile.drugAllergies;
            if (profile.foodAllergies) document.getElementById('foodAllergies').value = profile.foodAllergies;
            if (profile.envAllergies) document.getElementById('envAllergies').value = profile.envAllergies;
            if (profile.smoking) document.getElementById('smoking').value = profile.smoking;
            if (profile.alcohol) document.getElementById('alcohol').value = profile.alcohol;
            if (profile.exercise) document.getElementById('exercise').value = profile.exercise;
            if (profile.diet) document.getElementById('diet').value = profile.diet;
            if (profile.emergencyName) document.getElementById('emergencyName').value = profile.emergencyName;
            if (profile.emergencyPhone) document.getElementById('emergencyPhone').value = profile.emergencyPhone;
            if (profile.emergencyRelation) document.getElementById('emergencyRelation').value = profile.emergencyRelation;
            
            // Load medications
            if (profile.medications && profile.medications.length > 0) {
                const medicationsList = document.getElementById('medicationsList');
                medicationsList.innerHTML = '';
                profile.medications.forEach(med => {
                    addMedicationField(med);
                });
            }
            
            // Load conditions
            if (profile.conditions && profile.conditions.length > 0) {
                const conditionsList = document.getElementById('conditionsList');
                conditionsList.innerHTML = '';
                profile.conditions.forEach(condition => {
                    addConditionField(condition);
                });
            }
        });

        // Add medication field
        function addMedicationField(value = '') {
            const medicationsList = document.getElementById('medicationsList');
            const div = document.createElement('div');
            div.className = 'medication-item flex items-center space-x-4 p-4 border border-gray-200 rounded-lg';
            div.innerHTML = `
                <input type="text" name="medications[]" value="${value}" placeholder="Medication name and dosage" class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                <button type="button" class="remove-medication text-red-500 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            medicationsList.appendChild(div);
        }

        // Add condition field
        function addConditionField(value = '') {
            const conditionsList = document.getElementById('conditionsList');
            const div = document.createElement('div');
            div.className = 'condition-item flex items-center space-x-4 p-4 border border-gray-200 rounded-lg';
            div.innerHTML = `
                <input type="text" name="conditions[]" value="${value}" placeholder="Medical condition" class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                <button type="button" class="remove-condition text-red-500 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            conditionsList.appendChild(div);
        }

        // Event listeners
        document.getElementById('addMedicationBtn').addEventListener('click', () => addMedicationField());
        document.getElementById('addConditionBtn').addEventListener('click', () => addConditionField());

        // Remove medication/condition
        document.addEventListener('click', function(e) {
            if (e.target.closest('.remove-medication')) {
                e.target.closest('.medication-item').remove();
            }
            if (e.target.closest('.remove-condition')) {
                e.target.closest('.condition-item').remove();
            }
        });

        // Form submission
        document.getElementById('medicalProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const profile = {
                age: formData.get('age'),
                gender: formData.get('gender'),
                bloodGroup: formData.get('bloodGroup'),
                weight: formData.get('weight'),
                height: formData.get('height'),
                drugAllergies: formData.get('drugAllergies'),
                foodAllergies: formData.get('foodAllergies'),
                envAllergies: formData.get('envAllergies'),
                smoking: formData.get('smoking'),
                alcohol: formData.get('alcohol'),
                exercise: formData.get('exercise'),
                diet: formData.get('diet'),
                emergencyName: formData.get('emergencyName'),
                emergencyPhone: formData.get('emergencyPhone'),
                emergencyRelation: formData.get('emergencyRelation'),
                medications: Array.from(formData.getAll('medications[]')).filter(med => med.trim() !== ''),
                conditions: Array.from(formData.getAll('conditions[]')).filter(condition => condition.trim() !== ''),
                lastUpdated: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('userMedicalProfile', JSON.stringify(profile));
            
            // Show success message
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.remove('hidden');
            
            // Hide after 3 seconds
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 3000);
        });

        // --- Cart System (shared with medicines.html) ---
        const medicines = [
          { id: 1, name: 'Paracetamol 500mg', price: 49 },
          { id: 2, name: 'Cetrizine 10mg', price: 69 },
          { id: 3, name: 'Amoxicillin 500mg', price: 129 },
          { id: 4, name: 'Ibuprofen 200mg', price: 79 },
          { id: 5, name: 'Loratadine 10mg', price: 99 },
          { id: 6, name: 'Omeprazole 20mg', price: 119 },
          { id: 7, name: 'Azithromycin 250mg', price: 149 },
          { id: 8, name: 'Metformin 500mg', price: 89 },
          { id: 9, name: 'Pantoprazole 40mg', price: 109 },
          { id: 10, name: 'Dolo 650mg', price: 59 }
        ];
        function getCart() {
          return JSON.parse(localStorage.getItem('cart') || '{}');
        }
        function setCart(cart) {
          localStorage.setItem('cart', JSON.stringify(cart));
        }
        function updateCartCount() {
          const cart = getCart();
          let count = 0;
          for (let id in cart) count += cart[id];
          document.getElementById('cartCount').textContent = count;
        }
        document.addEventListener('DOMContentLoaded', function() {
          updateCartCount();
        });

        // --- Cart Modal ---
        const cartBtn = document.getElementById('cartBtn');
        const cartModal = document.getElementById('cartModal');
        const closeCartBtn = document.getElementById('closeCartBtn');
        const cartItemsDiv = document.getElementById('cartItems');
        const cartTotalSpan = document.getElementById('cartTotal');
        const buyBtn = document.getElementById('buyBtn');
        function renderCartModal() {
          const cart = getCart();
          let total = 0;
          let html = '';
          for (let id in cart) {
            const med = medicines.find(m => m.id == id);
            if (!med) continue;
            total += med.price * cart[id];
            html += `<div class='flex justify-between items-center mb-2'><div><span class='font-semibold'>${med.name}</span><br><span class='text-sm text-gray-500'>₹${med.price} x ${cart[id]}</span></div><div class='flex items-center'><button class='px-2 py-1 bg-gray-200 rounded-l' onclick='updateCartQty(${med.id},-1)'>-</button><span class='px-3'>${cart[id]}</span><button class='px-2 py-1 bg-gray-200 rounded-r' onclick='updateCartQty(${med.id},1)'>+</button></div></div>`;
          }
          cartItemsDiv.innerHTML = html || '<div class="text-gray-500">Your cart is empty.</div>';
          cartTotalSpan.textContent = `₹${total}`;
          buyBtn.disabled = total === 0;
        }
        window.updateCartQty = function(id, delta) {
          let c = getCart();
          c[id] = (c[id] || 0) + delta;
          if (c[id] <= 0) delete c[id];
          setCart(c);
          updateCartCount();
          renderCartModal();
        };
        if (cartBtn && cartModal && closeCartBtn) {
          cartBtn.onclick = () => { renderCartModal(); cartModal.classList.remove('hidden'); };
          closeCartBtn.onclick = () => { cartModal.classList.add('hidden'); };
          window.onclick = (e) => { if (e.target === cartModal) cartModal.classList.add('hidden'); };
        }
        buyBtn.onclick = function() {
          cartModal.classList.add('hidden');
          document.getElementById('paymentModal').classList.remove('hidden');
        };
        // --- Payment Modal ---
        const paymentModal = document.getElementById('paymentModal');
        const closePaymentBtn = document.getElementById('closePaymentBtn');
        const paymentForm = document.getElementById('paymentForm');
        const paymentSuccess = document.getElementById('paymentSuccess');
        if (closePaymentBtn && paymentModal) {
          closePaymentBtn.onclick = () => { paymentModal.classList.add('hidden'); paymentSuccess.classList.add('hidden'); paymentForm.reset(); };
          window.onclick = (e) => { if (e.target === paymentModal) paymentModal.classList.add('hidden'); };
        }
        paymentForm.onsubmit = function(e) {
          e.preventDefault();
          paymentSuccess.classList.remove('hidden');
          setTimeout(() => {
            paymentModal.classList.add('hidden');
            paymentSuccess.classList.add('hidden');
            paymentForm.reset();
            setCart({});
            updateCartCount();
          }, 1500);
        };

        // Modal open/close logic
        const bookBtn = document.getElementById('bookAppointmentBtn');
        const modal = document.getElementById('appointmentModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const appointmentForm = document.getElementById('appointmentForm');
        const appointmentSuccess = document.getElementById('appointmentSuccess');

        if (bookBtn && modal && closeModalBtn && appointmentForm) {
            bookBtn.onclick = () => {
                const user = JSON.parse(localStorage.getItem('loggedInUser'));
                if (!user) {
                    window.location.href = 'login.html?redirect=profile.html#book-appointment';
                } else {
                    modal.classList.remove('hidden');
                }
            };
            closeModalBtn.onclick = () => { modal.classList.add('hidden'); appointmentSuccess.classList.add('hidden'); appointmentForm.reset(); };
            window.onclick = (e) => { if (e.target === modal) { modal.classList.add('hidden'); appointmentSuccess.classList.add('hidden'); appointmentForm.reset(); } };
            appointmentForm.onsubmit = function(e) {
                e.preventDefault();
                // Simulate saving appointment (localStorage for now)
                const formData = new FormData(appointmentForm);
                const appointment = {
                    doctor: formData.get('doctor'),
                    date: formData.get('date'),
                    time: formData.get('time'),
                    reason: formData.get('reason'),
                    id: Date.now()
                };
                let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
                appointments.push(appointment);
                localStorage.setItem('appointments', JSON.stringify(appointments));
                appointmentSuccess.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    appointmentSuccess.classList.add('hidden');
                    appointmentForm.reset();
                }, 1500);
            };
        }

        // Show user name and icon in navbar
        const navbarUser = document.getElementById('navbarUser');
        const user = JSON.parse(localStorage.getItem('loggedInUser'));
        if (user && navbarUser) {
            navbarUser.innerHTML = `<i class='fas fa-user-circle text-primary text-2xl'></i><span class='font-medium text-gray-800'>${user.name || user.email}</span> <button id='logoutBtn' class='ml-2 px-2 py-1 bg-red-500 text-white rounded hover:bg-red-700 text-xs'>Logout</button>`;
            document.getElementById('logoutBtn').onclick = function() {
                localStorage.removeItem('loggedInUser');
                window.location.href = 'index.html';
            };
        } else if (navbarUser) {
            navbarUser.innerHTML = `<a href='login.html' class='bg-primary text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition inline-flex items-center'>Sign In</a>`;
        }
    </script>
    <script>
(function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="hNuFFiWlP9H7jCBHkGVmp";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
</script>
</body>
</html> 